<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Function to create a CallbackTuning.
Predefined callbacks are stored in the dictionary mlr_callbacks and can be retrieved with clbk().
Tuning callbacks can be called from different stages of tuning process.
The stages are prefixed with on_*.
Start Tuning
     - on_optimization_begin
    Start Tuner Batch
         - on_optimizer_before_eval
        Start Evaluation
             - on_eval_after_design
             - on_eval_after_benchmark
             - on_eval_before_archive
        End Evaluation
         - on_optimizer_after_eval
    End Tuner Batch
     - on_result
     - on_optimization_end
End Tuning

See also the section on parameters for more information on the stages.
A tuning callback works with bbotk::ContextOptimization and ContextEval."><title>Create Tuning Callback — callback_tuning • mlr3tuning</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.4/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.4/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.4/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create Tuning Callback — callback_tuning"><meta property="og:description" content="Function to create a CallbackTuning.
Predefined callbacks are stored in the dictionary mlr_callbacks and can be retrieved with clbk().
Tuning callbacks can be called from different stages of tuning process.
The stages are prefixed with on_*.
Start Tuning
     - on_optimization_begin
    Start Tuner Batch
         - on_optimizer_before_eval
        Start Evaluation
             - on_eval_after_design
             - on_eval_after_benchmark
             - on_eval_before_archive
        End Evaluation
         - on_optimizer_after_eval
    End Tuner Batch
     - on_result
     - on_optimization_end
End Tuning

See also the section on parameters for more information on the stages.
A tuning callback works with bbotk::ContextOptimization and ContextEval."><meta property="og:image" content="https://mlr3tuning.mlr-org.com/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mlr3tuning</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.17.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa fa fa-file-alt"></span>
     
    Reference
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mlr3book.mlr-org.com">
    <span class="fa fa fa fa-link"></span>
     
    mlr3book
  </a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlr-org/mlr3tuning/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create Tuning Callback</h1>
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3tuning/blob/HEAD/R/CallbackTuning.R" class="external-link"><code>R/CallbackTuning.R</code></a></small>
      <div class="d-none name"><code>callback_tuning.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function to create a <a href="CallbackTuning.html">CallbackTuning</a>.
Predefined callbacks are stored in the <a href="https://rdrr.io/pkg/mlr3misc/man/Dictionary.html" class="external-link">dictionary</a> <a href="https://rdrr.io/pkg/mlr3misc/man/mlr_callbacks.html" class="external-link">mlr_callbacks</a> and can be retrieved with <code><a href="https://rdrr.io/pkg/mlr3misc/man/clbk.html" class="external-link">clbk()</a></code>.</p>
<p>Tuning callbacks can be called from different stages of tuning process.
The stages are prefixed with <code>on_*</code>.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Start Tuning</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span> on_optimization_begin</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    Start Tuner Batch</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span> on_optimizer_before_eval</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        Start Evaluation</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>             <span class="sc">-</span> on_eval_after_design</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>             <span class="sc">-</span> on_eval_after_benchmark</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>             <span class="sc">-</span> on_eval_before_archive</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        End Evaluation</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span> on_optimizer_after_eval</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    End Tuner Batch</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span> on_result</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span> on_optimization_end</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>End Tuning</span></code></pre><p></p></div>
<p>See also the section on parameters for more information on the stages.
A tuning callback works with <a href="https://bbotk.mlr-org.com/reference/ContextOptimization.html" class="external-link">bbotk::ContextOptimization</a> and <a href="ContextEval.html">ContextEval</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">callback_tuning</span><span class="op">(</span></span>
<span>  <span class="va">id</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  man <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  on_optimization_begin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_optimizer_before_eval <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_eval_after_design <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_eval_after_benchmark <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_eval_before_archive <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_optimizer_after_eval <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_result <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  on_optimization_end <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>id</dt>
<dd><p>(<code>character(1)</code>)<br>
Identifier for the new instance.</p></dd>


<dt>label</dt>
<dd><p>(<code>character(1)</code>)<br>
Label for the new instance.</p></dd>


<dt>man</dt>
<dd><p>(<code>character(1)</code>)<br>
String in the format <code>[pkg]::[topic]</code> pointing to a manual page for this object.
The referenced help package can be opened via method <code>$help()</code>.</p></dd>


<dt>on_optimization_begin</dt>
<dd><p>(<code>function()</code>)<br>
Stage called at the beginning of the optimization.
Called in <code>Optimizer$optimize()</code>.
The context available is <a href="https://bbotk.mlr-org.com/reference/ContextOptimization.html" class="external-link">bbotk::ContextOptimization</a>.</p></dd>


<dt>on_optimizer_before_eval</dt>
<dd><p>(<code>function()</code>)<br>
Stage called after the optimizer proposes points.
Called in <code>OptimInstance$eval_batch()</code>.
The context available is <a href="https://bbotk.mlr-org.com/reference/ContextOptimization.html" class="external-link">bbotk::ContextOptimization</a>.</p></dd>


<dt>on_eval_after_design</dt>
<dd><p>(<code>function()</code>)<br>
Stage called after design is created.
Called in <code>ObjectiveTuning$eval_many()</code>.
The context available is <a href="ContextEval.html">ContextEval</a>.</p></dd>


<dt>on_eval_after_benchmark</dt>
<dd><p>(<code>function()</code>)<br>
Stage called after hyperparameter configurations are evaluated.
Called in <code>ObjectiveTuning$eval_many()</code>.
The context available is <a href="ContextEval.html">ContextEval</a>.</p></dd>


<dt>on_eval_before_archive</dt>
<dd><p>(<code>function()</code>)<br>
Stage called before performance values are written to the archive.
Called in <code>ObjectiveTuning$eval_many()</code>.
The context available is <a href="ContextEval.html">ContextEval</a>.</p></dd>


<dt>on_optimizer_after_eval</dt>
<dd><p>(<code>function()</code>)<br>
Stage called after points are evaluated.
Called in <code>OptimInstance$eval_batch()</code>.
The context available is <a href="https://bbotk.mlr-org.com/reference/ContextOptimization.html" class="external-link">bbotk::ContextOptimization</a>.</p></dd>


<dt>on_result</dt>
<dd><p>(<code>function()</code>)<br>
Stage called after result are written.
Called in <code>OptimInstance$assign_result()</code>.
The context available is <a href="https://bbotk.mlr-org.com/reference/ContextOptimization.html" class="external-link">bbotk::ContextOptimization</a>.</p></dd>


<dt>on_optimization_end</dt>
<dd><p>(<code>function()</code>)<br>
Stage called at the end of the optimization.
Called in <code>Optimizer$optimize()</code>.
The context available is <a href="https://bbotk.mlr-org.com/reference/ContextOptimization.html" class="external-link">bbotk::ContextOptimization</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When implementing a callback, each functions must have two arguments named <code>callback</code> and <code>context</code>.</p>
<p>A callback can write data to the state (<code>$state</code>), e.g. settings that affect the callback itself.
Avoid writing large data the state.
This can slow down the tuning process when the evaluation of configurations is parallelized.</p>
<p>Tuning callbacks access two different contexts depending on the stage.
The stages <code>on_eval_after_design</code>, <code>on_eval_after_benchmark</code>, <code>on_eval_before_archive</code> access <a href="ContextEval.html">ContextEval</a>.
This context can be used to customize the evaluation of a batch of hyperparameter configurations.
Changes to the state of callback are lost after the evaluation of a batch and changes to the tuning instance or the tuner are not possible.
Persistent data should be written to the archive via <code>$aggregated_performance</code> (see <a href="ContextEval.html">ContextEval</a>).
The other stages access ContextOptimization.
This context can be used to modify the tuning instance, archive, tuner and final result.
There are two different contexts because the evaluation can be parallelized i.e. multiple instances of <a href="ContextEval.html">ContextEval</a> exists on different workers at the same time.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># write archive to disk</span></span></span>
<span class="r-in"><span><span class="fu">callback_tuning</span><span class="op">(</span><span class="st">"mlr3tuning.backup"</span>,</span></span>
<span class="r-in"><span>  on_optimization_end <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">callback</span>, <span class="va">context</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">context</span><span class="op">$</span><span class="va">instance</span><span class="op">$</span><span class="va">archive</span>, <span class="st">"archive.rds"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;CallbackTuning:mlr3tuning.backup&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * Active Stages: on_optimization_end</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Marc Becker, Michel Lang, Jakob Richter, Bernd Bischl, Daniel Schalk.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

